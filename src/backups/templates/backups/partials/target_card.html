<div class="target-card{% if target.active_run %} running{% endif %}"
     id="target-{{ target.id }}"
     {% if target.active_run %}
     hx-get="{% url 'backups:backup_status' target.id %}"
     hx-trigger="every 2s"
     hx-swap="outerHTML"
     {% endif %}>

    <div class="card-header">
        <h3>
            {% if target.icon %}<span class="target-icon">{{ target.icon }}</span>{% endif %}
            <a href="{% url 'backups:target_detail' target.id %}">{{ target.name }}</a>
        </h3>
        <span class="status-badge status-{{ target.status }}">{{ target.get_status_display }}</span>
    </div>

    <div class="card-body">
        {% if target.description %}
        <p class="description">{{ target.description }}</p>
        {% endif %}

        <div class="backup-info">
            {% if target.active_run %}
            <div class="active-run">
                <span class="spinner"></span>
                <span>Backup in progress...</span>
            </div>
            {% elif target.last_run %}
            <div class="last-run">
                <span class="run-status status-{{ target.last_run.status }}">
                    {{ target.last_run.get_status_display }}
                </span>
                <span class="run-time">
                    {{ target.last_run.started_at|timesince }} ago
                </span>
            </div>
            {% if target.last_run.size_bytes %}
            <div class="run-size">
                {{ target.last_run.size_bytes|filesizeformat }}
            </div>
            {% endif %}
            {% else %}
            <div class="no-runs">
                <span>No backups yet</span>
            </div>
            {% endif %}
        </div>

        {% if target.schedule %}
        <div class="schedule">
            <span class="label">Schedule:</span>
            <code>{{ target.schedule }}</code>
        </div>
        {% endif %}
    </div>

    <div class="card-footer">
        {% if target.status == 'active' and not target.active_run %}
        <button
            class="btn btn-primary"
            hx-post="{% url 'backups:trigger_backup' target.id %}"
            hx-target="#target-{{ target.id }}"
            hx-swap="outerHTML">
            Backup Now
        </button>
        {% elif target.active_run %}
        <button class="btn btn-disabled" disabled>
            Running...
        </button>
        {% else %}
        <button class="btn btn-disabled" disabled>
            {{ target.get_status_display }}
        </button>
        {% endif %}
    </div>
</div>
